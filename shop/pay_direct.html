<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>直接支付</title>

    <!-- <link rel="stylesheet" href="../../../../static/lib/layui/css/layui.css ">
    <link href="../../../../static/css/style.css?t=<?php echo time(); ?>" rel="stylesheet" type="text/css" />
    <link href="../../../../static/css/iconfont.css" rel="stylesheet" type="text/css" />
    <script src="../../../../static/js/jquery.min.js"></script>
    <script src="../../../../static/js/qrcode.min.js"></script>
    <script src="../../../../static/js/mobile-util.js"></script>
    <script src="../../../../static/js/swipeSlide.min.js"></script>
    <script src="../../../../static/lib/layui/layui.js"></script>
    <script src="../../../../static/lib/layer_mobile/layer.js "></script>
    <script src="../../../../static/js/style.js"></script>
    <script src="../../../../static/js/global.js "></script> -->
    <link rel="stylesheet" href="../../../../../public/static/lib/layui/css/layui.css ">
    <link href="../../../../../public/static/css/style.css?t=<?php echo time(); ?>" rel="stylesheet" type="text/css" />
    <link href="../../../../../public/static/css/iconfont.css" rel="stylesheet" type="text/css" />
    <script src="../../../../../public/static/js/jquery.min.js"></script>
    <script src="../../../../../public/static/js/qrcode.min.js"></script>
    <script src="../../../../../public/static/js/mobile-util.js"></script>
    <script src="../../../../../public/static/js/swipeSlide.min.js"></script>
    <script src="../../../../../public/static/lib/layui/layui.js"></script>
    <script src="../../../../../public/static/lib/layer_mobile/layer.js "></script>
    <script src="../../../../../public/static/js/style.js"></script>
    <script src="../../../../../public/static/js/global.js "></script>
</head>
<style>
    html, body {
        background: #fff;
    }
    .pay-direct-wrap{
        background: #fff;
        font-size: 16px;
        color: #333;
        padding: 20px 20px 90px 20px;
    }
    .coupon-wrap, .bargain-amount, .total-discount {
        padding: 18px 0;
        border-bottom: 1px solid #eeeeee;
    }

    .coupon-num {
        float: right;
    }

    .total-discount {
        text-align: right;
    }
    .order-submit {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 90px;
        font-size: 0;
        color: #333;
        overflow: hidden;
        border-top: 1px solid #eeeeee;
    }
    .order-amount-wrap {
        display: inline-block;
        width: calc(100% - 100px);
        font-size: 18px;
        vertical-align: middle;
        padding-left: 20px;
    }
    .order-amount-wrap .order-amount {
        height: 40px;
        line-height: 40px;
        display: block;
        font-weight: bold;
    }
    .submit-btn {
        /*按钮固定宽度*/
        width: 100px;
        height: 90px;
        line-height: 90px;
        font-size: 16px;
        vertical-align: middle;
    }

    .coupon-list-dialog {
        display: none;
    }
    .coupon-list-wrap {
        padding: 20px;
        color: #333;
        font-size: 20px;
        background: #fff;
        border-radius: 20px 20px 0 0;
    }
    .dialog-title {
        text-align: center;
        margin-bottom: 20px;
    }
  
    .coupon-item {
        padding: 20px 12px;
        display: flex;
        align-items: center;
        border-bottom: 1px solid #e2e2e2;
    }
    .coupon-name {
        flex: 1;
    }
    .coupon-amount {
        width: 60px;
    }
    .coupon-btn {
        height: 28px;
        width: 28px;
        text-align: right;
    }
  
    .check-save {
        display: block;
        width: 50%;
        margin: 20px auto 10px auto;
    }
    .close-btn {
        position: absolute;
        top: 16px;
        right: 24px;
        font-size: 26px;
    }
    .bargain-amount span{
        display: inline-block;
    }
    .amount-left{
        float: left;
    }
    .amount-right{
        float: right;
    }
    .coupon-wrap{
        clear: both;
    }
  
    .pay-way-item {
        margin: 18px 0;
        display: flex;
        align-items: center;
    }
    .pay-way-icon {
        width: 45px;
        font-size: 45px;
    }
    .pay-way-title {
        flex: 1;
        padding-left: 20px;
    }
    .pay-way-btn {
        width: 60px;
        height: 26px;
    }
</style>
<body>
<!--顶部搜索栏-s-->

<!--顶部搜索栏-e-->
<div class="pay-direct-wrap">
    <div class="bargain-amount">
        <span class="amount-left">订单金额:</span>
        <span class="amount-right">￥
            <span id="orderMoney">{$order['money']}</span>
        </span>
    </div>
    <div class="bargain-amount">
        <span class="amount-left">砍价金额:</span> 
        <span class="amount-right">￥<span id="cutmoney">{$order['cutmoney']}</span></span>
    </div>
    <div class="coupon-wrap">
        优惠券
        <span onclick="openDialog({$quan_count})" class="coupon-num">{$quan_count}张优惠券 ></span>
    </div>

    <div class="total-discount">
        合计优惠: ￥<span id="totalDiscount">{$order['cutmoney']}</span>
    </div>
    
    <label class="pay-way-item">
      <img src="../../../../../static/images/nmy.png" alt="" class="pay-way-icon">
        <span class="pay-way-title">余额支付(￥{$userinfo['money']})</span>
        <input type="radio" name="payWay" checked value="0" title="余额" class="pay-way-btn">
    </label>
    <label class="pay-way-item">
        <img src="../../../../../static/images/wechat.png" alt="" class="pay-way-icon">
        <span class="pay-way-title">微信支付</span>
        <input type="radio" name="payWay" value="1" title="微信" class="pay-way-btn">
    </label>
</div>
<div class="order-submit">
    <div class="order-amount-wrap">
        <h4 class="order-amount">实付金额: 
        ￥<span id="actualMoney">{$order['money']-$order['cutmoney']}</span>
        </h4>
        <div class="balance">余额: ￥
            <span id="balanceMoney">{$userinfo['money']}</span>
        </div>
    </div>
    <button id="submitBtn" onclick="submitOrder(event)" class="layui-btn layui-btn-normal submit-btn">提交订单</button>
</div>
<div id="dialog" class="coupon-list-dialog">
    <div class="coupon-list-wrap">
        <h4 class="dialog-title">优惠券</h4>
        <i onclick="closeDialog()" class="layui-icon layui-icon-close close-btn"></i>
        <ul>
            {volist name="quan_list" id="item"}
            <li>
                <label class="coupon-item">
                    <span class="coupon-name">{$item['name']}</span>
                    <span class="coupon-amount">￥{$item['money']}</span>
                    <input type="radio" name="couponItem" class="coupon-btn" value="{$item['money']}" disabled>
                </label>
            </li>
            {/volist}
            <li>
                <label class="coupon-item">
                    <span class="coupon-name">不使用优惠券</span>
                    <span class="coupon-amount"></span>
                    <input type="radio" name="couponItem" class="coupon-btn" checked value="0">
                </label>
            </li>
        </ul>
        <button onclick="checkCoupon()" type="button" class="layui-btn layui-btn-radius layui-btn-danger check-save">确定</button>
    </div>
</div>
<!--底部-start-->

<!--底部-end-->
<!--底部导航-start-->
<script type="text/javascript">
    var layuiLayer = null
    layui.use('layer', function(){
      layuiLayer = layui.layer
    })
    function openDialog (num) {
        if (num === 0) {
          return false
        }
        layer.open({
            type: 1,
            content: $('#dialog').html(),
            anim: 'up',
            style: 'position:fixed; bottom:0; left:0; width: 100%; border-radius: 20px 20px 0 0; border:none;'
        })
    }

    // 订单金额
    var orderMoney = 1 * $("#orderMoney").text()
    // 实付金额
    var actualMoney = 1 * $("#actualMoney").text()
    // 余额
    var balanceMoney = 1 * $("#balanceMoney").text()


    function checkPayWay () {
        var payWay = $("input[name='payWay']:checked").val()

        if (payWay === '1') {
            // 微信支付
            $("#submitBtn").text("提交订单")
        } else {
            if (balanceMoney >= actualMoney) {
                $("#submitBtn").text("去支付")
            } else {
                $("#submitBtn").text("充值并支付")
            }
        }
    }

    checkPayWay()

    // 选择支付方式
    $(document).on('click', '.pay-way-item', checkPayWay)

    function checkCoupon () {
        if (coupon + cutmoney > orderMoney) {
            layuiLayer.msg('请重新选择优惠券', {time: 1000})
            return
        }
        // 优惠劵金额
        var coupon = 1 * $("input[name='couponItem']:checked").val()
        // 砍价金额
        var cutmoney = 1 * $("#cutmoney").text()
        // 合计优惠金额
        $('#totalDiscount').text(coupon + cutmoney)
        // 实付金额
        actualMoney = orderMoney - (coupon + cutmoney)
        $("#actualMoney").text(actualMoney)

        layer.closeAll()
    }

    // 提交订单
    function submitOrder (ev) {
        if (coupon + cutmoney > orderMoney) {
            layuiLayer.msg('请重新选择优惠券', {time: 1000})
            return
        }
        // 支付方式
        var payWay = $("input[name='payWay']:checked").val()

        if (payWay === '1') {
            // 微信支付
            
        } else {
            if (balanceMoney < actualMoney) {
            // 余额不足
                window.location.href = './rechange.html'
            } else {
                // 直接支付
                
            }
        }
    }

    function closeDialog () {
        layer.closeAll()
    }
</script>
</body>
</html>